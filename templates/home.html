{% extends "base.html" %}

{% block content %}
<div class="container mt-5">
    <div class="row">
        <!-- Key Generation Card -->
        <div class="col-md-4">
            <div class="card">
                <div class="card-body">
                    <h2 class="text-primary mb-4">Key Generation</h2>
                    <div class="mb-3">
                        <label for="keySize" class="form-label">Key Size</label>
                        <select class="form-select" id="keySize">
                            <option value="1024">1024 bits</option>
                            <option value="2048">2048 bits</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="publicKey" class="form-label">Public Key</label>
                        <div class="input-group">
                            <textarea class="form-control" id="publicKey" rows="4" readonly></textarea>
                            <div id="publicKeyButtons" style="display: none;">
                                <button class="btn btn-outline-secondary" type="button" onclick="copyToClipboard('publicKey')">Copy</button>
                                <button class="btn btn-outline-secondary" type="button" onclick="downloadText('publicKey', 'public_key.txt')">Download</button>
                            </div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="privateKey" class="form-label">Private Key</label>
                        <div class="input-group">
                            <textarea class="form-control" id="privateKey" rows="4" readonly></textarea>
                            <div id="privateKeyButtons" style="display: none;">
                                <button class="btn btn-outline-secondary" type="button" onclick="copyToClipboard('privateKey')">Copy</button>
                                <button class="btn btn-outline-secondary" type="button" onclick="downloadText('privateKey', 'private_key.txt')">Download</button>
                            </div>
                        </div>
                    </div>
                    <button class="btn w-100" onclick="generateKeys()" style="background-color: #2196F3; border-color: #2196F3; color: white;">Generate Keys</button>
                </div>
            </div>
        </div>

        <!-- Encryption Card -->
        <div class="col-md-4">
            <div class="card">
                <div class="card-body">
                    <h2 class="text-primary mb-4">Encrypt Message</h2>
                    <div class="mb-3">
                        <label for="message" class="form-label">Message</label>
                        <textarea class="form-control" id="message" rows="4" placeholder="Enter message to encrypt"></textarea>
                    </div>
                    <div class="mb-3">
                        <label for="encryptPublicKey" class="form-label">Public Key</label>
                        <textarea class="form-control" id="encryptPublicKey" rows="4" placeholder="Enter public key (e,n)"></textarea>
                    </div>
                    <div class="mb-3">
                        <label for="encryptedMessage" class="form-label">Encrypted Message</label>
                        <div class="input-group">
                            <textarea class="form-control" id="encryptedMessage" rows="4" readonly></textarea>
                            <div id="encryptedButtons" style="display: none;">
                                <button class="btn btn-outline-secondary" type="button" onclick="copyToClipboard('encryptedMessage')">Copy</button>
                                <button class="btn btn-outline-secondary" type="button" onclick="downloadText('encryptedMessage', 'ciphertext.txt')">Download</button>
                            </div>
                        </div>
                    </div>
                    <button class="btn btn-primary w-100 mb-2" onclick="pastePublicKey()">Paste Public Key</button>
                    <button class="btn w-100" onclick="encryptMessage()" style="background-color: #2196F3; border-color: #2196F3; color: white;">Encrypt</button>
                </div>
            </div>
        </div>

        <!-- Decryption Card -->
        <div class="col-md-4">
            <div class="card">
                <div class="card-body">
                    <h2 class="text-primary mb-4">Decrypt Message</h2>
                    <div class="mb-3">
                        <label for="ciphertext" class="form-label">Ciphertext</label>
                        <textarea class="form-control" id="ciphertext" rows="4" placeholder="Enter ciphertext to decrypt"></textarea>
                    </div>
                    <div class="mb-3">
                        <label for="decryptPrivateKey" class="form-label">Private Key</label>
                        <textarea class="form-control" id="decryptPrivateKey" rows="4" placeholder="Enter private key (d,n)"></textarea>
                    </div>
                    <div class="mb-3">
                        <label for="decryptedMessage" class="form-label">Decrypted Message</label>
                        <div class="input-group">
                            <textarea class="form-control" id="decryptedMessage" rows="4" readonly></textarea>
                            <div id="decryptedButtons" style="display: none;">
                                <button class="btn btn-outline-secondary" type="button" onclick="copyToClipboard('decryptedMessage')">Copy</button>
                                <button class="btn btn-outline-secondary" type="button" onclick="downloadText('decryptedMessage', 'message.txt')">Download</button>
                            </div>
                        </div>
                    </div>
                    <button class="btn btn-primary w-100 mb-2" onclick="pastePrivateKey()">Paste Private Key</button>
                    <button class="btn w-100" onclick="decryptMessage()" style="background-color: #2196F3; border-color: #2196F3; color: white;">Decrypt</button>
                </div>
            </div>
        </div>
    </div>
</div>

{% block scripts %}
<script>
function showButtons(elementId) {
    document.getElementById(elementId + 'Buttons').style.display = 'block';
}

function copyToClipboard(elementId) {
    const element = document.getElementById(elementId);
    element.select();
    document.execCommand('copy');
    alert('Copied to clipboard!');
}

function downloadText(elementId, filename) {
    const element = document.getElementById(elementId);
    const text = element.value;
    const blob = new Blob([text], { type: 'text/plain' });
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = filename;
    document.body.appendChild(a);
    a.click();
    window.URL.revokeObjectURL(url);
    document.body.removeChild(a);
}

function pastePublicKey() {
    document.getElementById('encryptPublicKey').value = document.getElementById('publicKey').value;
}

function pastePrivateKey() {
    document.getElementById('decryptPrivateKey').value = document.getElementById('privateKey').value;
}

function generateKeys() {
    const bits = document.getElementById('keySize').value;
    fetch('/generate_keys', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
        },
        body: `bits=${bits}`
    })
    .then(response => response.json())
    .then(data => {
        document.getElementById('publicKey').value = data.public_key;
        document.getElementById('privateKey').value = data.private_key;
        showButtons('publicKey');
        showButtons('privateKey');
    });
}

function encryptMessage() {
    const message = document.getElementById('message').value;
    const publicKey = document.getElementById('encryptPublicKey').value;
    
    fetch('/encrypt', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
        },
        body: `message=${encodeURIComponent(message)}&public_key=${encodeURIComponent(publicKey)}`
    })
    .then(response => response.json())
    .then(data => {
        document.getElementById('encryptedMessage').value = data.cipher;
        showButtons('encrypted');
    });
}

function decryptMessage() {
    const cipher = document.getElementById('ciphertext').value;
    const privateKey = document.getElementById('decryptPrivateKey').value;
    
    fetch('/decrypt', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
        },
        body: `cipher=${encodeURIComponent(cipher)}&private_key=${encodeURIComponent(privateKey)}`
    })
    .then(response => response.json())
    .then(data => {
        document.getElementById('decryptedMessage').value = data.message;
        showButtons('decrypted');
    })
    .catch(error => {
        console.error('Error:', error);
        document.getElementById('decryptedMessage').value = 'Error decrypting message. Please check your private key and ciphertext.';
    });
}
</script>
{% endblock %}
{% endblock %} 